<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Agenda da Eliane</title>
    <link rel="stylesheet" href="estilo.css">
	<link rel="manifest" href="manifest.json">
	<meta name="theme-color" content="#2c7be5">

</head>
<body>

<h1>Agenda de DiÃ¡rias</h1>

<h2>Nova DiÃ¡ria</h2>

<form id="formDiaria">
    <label>Data:</label><br>
    <input type="date" id="data"><br><br>

    <label>HorÃ¡rio:</label><br>
    <input type="time" id="horario"><br><br>

    <label>Cliente:</label><br>
    <input type="text" id="cliente"><br><br>

    <label>EndereÃ§o:</label><br>
    <input type="text" id="endereco"><br><br>

    <label>Valor:</label><br>
    <input type="number" id="valor"><br><br>

    <button type="button" onclick="adicionarDiaria()">Salvar</button>
</form>

<h2>Filtrar por data</h2>
<input type="date" id="filtroData">
<button onclick="filtrarPorData()">Filtrar</button>
<button onclick="mostrarDiarias()">Mostrar todas</button>

<h2>DiÃ¡rias Agendadas</h2>
<div id="listaDiarias"></div>

<script>
let diarias = JSON.parse(localStorage.getItem("diarias")) || [];
let indiceEdicao = null;

mostrarDiarias();

function adicionarDiaria() {
    let data = document.getElementById("data").value;
    let horario = document.getElementById("horario").value;
    let cliente = document.getElementById("cliente").value;
    let endereco = document.getElementById("endereco").value;
    let valor = document.getElementById("valor").value;

    if (!data || !horario || !cliente || !valor) {
        alert("Preencha todos os campos obrigatÃ³rios!");
        return;
    }

    let conflito = diarias.some((d, i) =>
        d.data === data && d.horario === horario && i !== indiceEdicao
    );

    if (conflito) {
        alert("JÃ¡ existe uma diÃ¡ria nesse horÃ¡rio!");
        return;
    }

    if (indiceEdicao !== null) {
        diarias[indiceEdicao] = { data, horario, cliente, endereco, valor };
        indiceEdicao = null;
    } else {
        diarias.push({ data, horario, cliente, endereco, valor });
    }

    salvarDiarias();
    mostrarDiarias();
    limparFormulario();
}

function editarDiaria(index) {
    let d = diarias[index];

    document.getElementById("data").value = d.data;
    document.getElementById("horario").value = d.horario;
    document.getElementById("cliente").value = d.cliente;
    document.getElementById("endereco").value = d.endereco;
    document.getElementById("valor").value = d.valor;

    indiceEdicao = index;
}

function excluirDiaria(index) {
    if (confirm("Tem certeza que deseja excluir esta diÃ¡ria?")) {
        diarias.splice(index, 1);
        salvarDiarias();
        mostrarDiarias();
    }
}

function ordenarDiarias() {
    diarias.sort((a, b) => {
        let dataHoraA = new Date(a.data + " " + a.horario);
        let dataHoraB = new Date(b.data + " " + b.horario);
        return dataHoraA - dataHoraB;
    });
}

function mostrarDiarias() {
    ordenarDiarias();

    let lista = document.getElementById("listaDiarias");
    lista.innerHTML = "";

    diarias.forEach((d, index) => {
        lista.innerHTML += `
            <div>
                ğŸ“… ${d.data} - â° ${d.horario}<br>
                ğŸ‘¤ ${d.cliente}<br>
                ğŸ“ ${d.endereco}<br>
                ğŸ’° R$ ${d.valor}<br><br>

                <button onclick="editarDiaria(${index})">Editar</button>
                <button onclick="excluirDiaria(${index})">Excluir</button>
            </div>
            <hr>
        `;
    });
}

function filtrarPorData() {
    let dataFiltro = document.getElementById("filtroData").value;
    let lista = document.getElementById("listaDiarias");
    lista.innerHTML = "";

    let filtradas = diarias.filter(d => d.data === dataFiltro);

    if (filtradas.length === 0) {
        lista.innerHTML = "<p>Nenhuma diÃ¡ria encontrada.</p>";
        return;
    }

    filtradas.forEach(d => {
        lista.innerHTML += `
            <p>
                ğŸ“… ${d.data} - â° ${d.horario}<br>
                ğŸ‘¤ ${d.cliente}<br>
                ğŸ’° R$ ${d.valor}
            </p>
            <hr>
        `;
    });
}

function salvarDiarias() {
    localStorage.setItem("diarias", JSON.stringify(diarias));
}

function limparFormulario() {
    document.getElementById("formDiaria").reset();
}
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("Service Worker registrado"));
}
</script>

</body>
</html>
